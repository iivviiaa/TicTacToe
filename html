<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>è¶…çº§äº•å­—æ£‹</title>
  <!-- å¼•å…¥ Font Awesome å›¾æ ‡åº“ -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <style>
    /* è“è‰²ä¸»é¢˜å˜é‡ */
    :root {
      --primary: #165DFF;
      --primary-light: #4080FF;
      --primary-dark: #0E42D2;
      --player-color: #165DFF;
      --computer-color: #FF7D00;
      --winner-bg: #D6E4FF;
      --winner-border: #0E42D2;
      --active-bg: #E8F3FF;
      --active-border: #165DFF;
    }

    /* é¡µé¢èƒŒæ™¯æ¸å˜ */
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #F5F7FA 0%, #E4ECFF 100%);
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      color: #333;
    }
    
    /* èƒŒæ™¯è£…é¥°å…ƒç´  */
    body::before,
    body::after {
      content: '';
      position: fixed;
      width: 300px;
      height: 300px;
      border-radius: 50%;
      z-index: -1;
    }
    
    body::before {
      top: -100px;
      right: -100px;
      background: rgba(22, 93, 255, 0.1);
    }
    
    body::after {
      bottom: -100px;
      left: -100px;
      background: rgba(255, 125, 0, 0.05);
    }
    
    h1 {
      margin-bottom: 10px;
      color: var(--primary);
      font-size: 2.5rem;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      text-align: center;
    }
    
    .score {
      display: flex;
      gap: 40px;
      margin-bottom: 20px;
      font-size: 1.25rem;
      font-weight: 600;
      justify-content: center;
    }
    
    .player-score { color: var(--player-color); }
    .computer-score { color: var(--computer-color); }
    
    .game-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .left-panel {
      flex: 1 1 60%;
      min-width: 300px;
    }
    
    .right-panel {
      flex: 1 1 30%;
      min-width: 300px;
    }
    
    .rule-box {
      background: #fff;
      border: 1px solid #E5E7EB;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      transition: transform 0.3s ease;
      font-size: 0.9rem;
      height: fit-content;
    }
    
    .rule-box:hover {
      transform: translateY(-2px);
    }
    
    .rule-box h3 {
      margin-top: 0;
      color: var(--primary);
      font-size: 1.1rem;
      font-weight: 600;
      display: flex;
      align-items: center;
    }
    
    .rule-box h3::before {
      content: "ğŸ“œ";
      margin-right: 10px;
    }
    
    .rule-box ol {
      margin: 0;
      padding-left: 20px;
      line-height: 1.5;
    }
    
    .rule-box li {
      margin-bottom: 10px;
    }
    
    .control {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 25px;
      justify-content: center;
    }
    
    .control button {
      padding: 10px 20px;
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 500;
      transition: all 0.2s ease;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    
    .control button:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
      box-shadow: 0 6px 8px rgba(0,0,0,0.15);
    }
    
    .control button:active {
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .hint {
      font-size: 1rem;
      color: #666;
      font-weight: 500;
    }
    
    /* å¤§æ£‹ç›˜æ ·å¼ï¼šç”¨ Grid æ”¾ 9 ä¸ªå°æ£‹ç›˜ */
    #big-board {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      padding: 20px;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.1);
      max-width: 800px;
      width: 100%;
      backdrop-filter: blur(8px);
      background: rgba(255, 255, 255, 0.8);
    }
    
    /* å°æ£‹ç›˜æ ·å¼ï¼šç”¨ Grid æ”¾ 9 ä¸ªæ ¼å­ */
    .small-board {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 8px;
      background: #F5F7FA;
      border-radius: 10px;
      padding: 8px;
      aspect-ratio: 1/1;
      transition: all 0.3s ease;
    }
    
    .small-board:not(.winner):hover {
      transform: scale(1.02);
      box-shadow: 0 4px 12px rgba(22, 93, 255, 0.1);
    }
    
    /* æ´»è·ƒå°æ£‹ç›˜æ ·å¼ï¼ˆå¿…é¡»è½å­çš„å°æ£‹ç›˜ï¼‰ */
    .small-board.active {
      background: var(--active-bg);
      border: 2px solid var(--active-border);
      animation: pulse-active 1.5s infinite;
    }
    
    @keyframes pulse-active {
      0% { box-shadow: 0 0 0 0 rgba(22, 93, 255, 0.2); }
      70% { box-shadow: 0 0 0 6px rgba(22, 93, 255, 0); }
      100% { box-shadow: 0 0 0 0 rgba(22, 93, 255, 0); }
    }
    
    /* æ ¼å­æ ·å¼ */
    .cell {
      background: #fff;
      border: 2px solid #E5E7EB;
      border-radius: 8px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 2.2rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
      aspect-ratio: 1/1;
    }
    
    .cell:not(.disabled):hover {
      background: #F0F2F5;
      border-color: var(--primary-light);
      transform: scale(1.05);
    }
    
    /* ç©å®¶æ ‡è®°æ ·å¼ */
    .cell.X .player-icon {
      color: var(--player-color);
      font-size: 2.5rem;
    }
    
    .cell.O .computer-icon {
      color: var(--computer-color);
      font-size: 2.5rem;
    }
    
    /* ç¦ç”¨çŠ¶æ€ï¼ˆå·²è½å­ï¼‰ */
    .cell.disabled {
      cursor: not-allowed;
      background: #F5F7FA;
    }
    
    /* è·èƒœå°æ£‹ç›˜é«˜äº® */
    .small-board.winner {
      background: var(--winner-bg);
      border: 2px solid var(--winner-border);
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(22, 93, 255, 0.4); }
      70% { box-shadow: 0 0 0 8px rgba(22, 93, 255, 0); }
      100% { box-shadow: 0 0 0 0 rgba(22, 93, 255, 0); }
    }
    
    /* å“åº”å¼å¸ƒå±€ */
    @media (max-width: 1024px) {
      .game-container {
        flex-direction: column;
      }
      
      .rule-box {
        margin-bottom: 20px;
      }
    }
    
    @media (max-width: 768px) {
      #big-board {
        gap: 12px;
        padding: 12px;
      }
      
      .small-board {
        gap: 5px;
        padding: 5px;
      }
      
      .cell.X .player-icon,
      .cell.O .computer-icon {
        font-size: 2rem;
      }
    }
    
    @media (max-width: 500px) {
      .rule-box {
        font-size: 0.8rem;
      }
      
      #big-board {
        gap: 8px;
        padding: 8px;
      }
      
      .small-board {
        gap: 3px;
        padding: 3px;
      }
      
      .cell.X .player-icon,
      .cell.O .computer-icon {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <h1>è¶…çº§äº•å­—æ£‹</h1>
  <div class="score">
    <div class="player-score">ç©å®¶ (X)ï¼š<span id="player-score">0</span></div>
    <div class="computer-score">ç”µè„‘ (O)ï¼š<span id="computer-score">0</span></div>
  </div>

  <div class="game-container">
    <div class="left-panel">
      <div class="control">
        <button id="restart-btn">é‡æ–°å¼€å§‹</button>
        <span id="hint" class="hint">ç‚¹å‡»å°æ ¼å­è½å­ï¼Œä¸‹ä¸€å›åˆéœ€åœ¨å¯¹åº”å°æ£‹ç›˜ä½ç½®è½å­</span>
      </div>

      <!-- å¤§æ£‹ç›˜å®¹å™¨ -->
      <div id="big-board"></div>
    </div>
    
    <div class="right-panel">
      <div class="rule-box">
        <h3>æ¸¸æˆè§„åˆ™</h3>
        <ol>
          <li>æ¸¸æˆç”± 9 ä¸ªå°äº•å­—æ£‹ç»„æˆä¸€ä¸ªå¤§æ£‹ç›˜ï¼Œç©å®¶ä½¿ç”¨ Xï¼Œç”µè„‘ä½¿ç”¨ Oã€‚</li>
          <li>ç©å®¶å…ˆæ‰‹ï¼Œåœ¨ä»»æ„ä¸€ä¸ªå°æ£‹ç›˜çš„ä»»æ„ä¸€æ ¼è½å­ã€‚ä¹‹åï¼Œæ ¹æ®è½å­çš„ä½ç½®ï¼Œå¯¹æ‰‹å¿…é¡»åœ¨å¯¹åº”çš„å°æ£‹ç›˜ä¸­è½å­ã€‚</li>
          <li>ä¾‹å¦‚ï¼šä½ åœ¨æŸä¸ªå°æ£‹ç›˜çš„å³ä¸Šè§’è½å­ï¼Œä½ åœ¨ä¸‹ä¸€å›åˆåªèƒ½åœ¨å¤§æ£‹ç›˜ä¸­å³ä¸Šè§’çš„å°æ£‹ç›˜é‡Œè½å­ã€‚</li>
          <li>å¦‚æœæŒ‡å®šçš„å°æ£‹ç›˜å·²ç»è¢«å¡«æ»¡æˆ–å·²æœ‰èƒœè€…ï¼Œåˆ™å¯ä»¥åœ¨ä»»æ„å°æ£‹ç›˜è½å­ã€‚</li>
          <li>ä¸€æ–¹åœ¨å°æ£‹ç›˜å†…å½¢æˆä¸‰å­è¿çº¿ï¼ˆæ¨ªã€ç«–ã€æ–œï¼‰æ—¶ï¼Œè¯¥å°æ£‹ç›˜æŒ‰è¯¥æ–¹å é¢†ï¼Œå¹¶ä»¥é«˜äº®æ˜¾ç¤ºã€‚</li>
          <li>æœ€ç»ˆåœ¨å¤§æ£‹ç›˜ä¸­å½¢æˆä¸‰å­è¿çº¿ï¼ˆå é¢†ä¸‰ä¸ªå°æ£‹ç›˜ï¼‰çš„ä¸€æ–¹è·èƒœã€‚</li>
        </ol>
      </div>
    </div>
  </div>

  <script>
    // æ¸¸æˆæ ¸å¿ƒçŠ¶æ€
    let game = {
      bigBoard: Array(9).fill(null), // è®°å½•æ¯ä¸ªå°æ£‹ç›˜çš„èƒœè€…ï¼š'X'/'O'/null
      smallBoards: Array(9).fill(null).map(() => Array(9).fill(null)), // æ¯ä¸ªå°æ£‹ç›˜çš„è½å­æƒ…å†µ
      currentPlayer: 'X', // å½“å‰ç©å®¶ï¼š'X'ï¼ˆç©å®¶ï¼‰ / 'O'ï¼ˆç”µè„‘ï¼‰
      activeSmall: -1, // å½“å‰å¿…é¡»è½å­çš„å°æ£‹ç›˜ç´¢å¼•ï¼Œ-1 è¡¨ç¤ºæ— é™åˆ¶
      playerScore: 0,
      computerScore: 0,
      isOver: false
    };

    // DOM å…ƒç´ ç¼“å­˜
    const bigBoardEl = document.getElementById('big-board');
    const playerScoreEl = document.getElementById('player-score');
    const computerScoreEl = document.getElementById('computer-score');
    const restartBtn = document.getElementById('restart-btn');
    const hintEl = document.getElementById('hint');

    // åˆå§‹åŒ–æ¸¸æˆï¼ˆæ¸²æŸ“æ£‹ç›˜ + ç»‘å®šäº‹ä»¶ï¼‰
    function init() {
      renderBoard();
      restartBtn.addEventListener('click', restartGame);
    }

    // æ¸²æŸ“å¤§æ£‹ç›˜ï¼ˆ9 ä¸ªå°æ£‹ç›˜ + æ¯ä¸ªå°æ£‹ç›˜ 9 ä¸ªæ ¼å­ï¼‰
    function renderBoard() {
      bigBoardEl.innerHTML = ''; // æ¸…ç©ºæ—§æ£‹ç›˜
      for (let smallIndex = 0; smallIndex < 9; smallIndex++) {
        const smallBoardEl = document.createElement('div');
        smallBoardEl.className = 'small-board';
        smallBoardEl.dataset.index = smallIndex;

        // æ£€æŸ¥æ˜¯å¦æ˜¯å½“å‰æ´»è·ƒçš„å°æ£‹ç›˜
        if (game.activeSmall === smallIndex && game.currentPlayer === 'X') {
          smallBoardEl.classList.add('active');
        }

        for (let cellIndex = 0; cellIndex < 9; cellIndex++) {
          const cellEl = document.createElement('div');
          cellEl.className = 'cell';
          cellEl.dataset.small = smallIndex;
          cellEl.dataset.cell = cellIndex;
          cellEl.addEventListener('click', handleCellClick);
          
          // æ¢å¤å·²è½å­çš„çŠ¶æ€
          if (game.smallBoards[smallIndex][cellIndex]) {
            if (game.smallBoards[smallIndex][cellIndex] === 'X') {
              cellEl.innerHTML = '<i class="fa fa-times player-icon"></i>'; // ä¿®æ”¹ä¸º Font Awesome 4.x å…¼å®¹çš„å›¾æ ‡ç±»å
            } else {
              cellEl.innerHTML = '<i class="fa fa-circle computer-icon"></i>'; // ä¿®æ”¹ä¸º Font Awesome 4.x å…¼å®¹çš„å›¾æ ‡ç±»å
            }
            cellEl.classList.add('disabled');
          }
          
          smallBoardEl.appendChild(cellEl);
        }
        
        // æ¢å¤å·²è·èƒœçš„å°æ£‹ç›˜çŠ¶æ€
        if (game.bigBoard[smallIndex]) {
          smallBoardEl.classList.add('winner');
        }
        
        bigBoardEl.appendChild(smallBoardEl);
      }
    }

    // å¤„ç†ç©å®¶ç‚¹å‡»è½å­
    function handleCellClick(e) {
      if (game.isOver || game.currentPlayer !== 'X') return; // æ¸¸æˆç»“æŸæˆ–éç©å®¶å›åˆï¼Œä¸å“åº”

      const cellEl = e.target;
      const smallIndex = parseInt(cellEl.dataset.small);
      const cellIndex = parseInt(cellEl.dataset.cell);

      // æ£€æŸ¥æ˜¯å¦å¿…é¡»åœ¨æŒ‡å®šå°æ£‹ç›˜è½å­
      if (game.activeSmall !== -1 && game.activeSmall !== smallIndex) {
        showNotification('éœ€åœ¨æŒ‡å®šå°æ£‹ç›˜è½å­ï¼', 'error');
        return;
      }
      // æ£€æŸ¥è¯¥ä½ç½®æ˜¯å¦å·²è½å­æˆ–å°æ£‹ç›˜å·²åˆ†èƒœè´Ÿ
      if (game.smallBoards[smallIndex][cellIndex] || game.bigBoard[smallIndex]) {
        showNotification('è¯¥ä½ç½®ä¸å¯è½å­ï¼', 'error');
        return;
      }

      // ç©å®¶è½å­ï¼ˆXï¼‰
      game.smallBoards[smallIndex][cellIndex] = 'X';
      cellEl.innerHTML = '<i class="fa fa-times player-icon"></i>'; // ä¿®æ”¹ä¸º Font Awesome 4.x å…¼å®¹çš„å›¾æ ‡ç±»å
      cellEl.classList.add('disabled');
      
      // æ·»åŠ è½å­åŠ¨ç”»
      const icon = cellEl.querySelector('.player-icon');
      icon.style.transform = 'scale(0)';
      icon.style.opacity = '0';
      setTimeout(() => {
        icon.style.transition = 'all 0.3s ease';
        icon.style.transform = 'scale(1)';
        icon.style.opacity = '1';
      }, 10);

      // æ£€æŸ¥å½“å‰å°æ£‹ç›˜æ˜¯å¦åˆ†èƒœè´Ÿ
      const smallWinner = checkSmallWinner(smallIndex);
      if (smallWinner) {
        game.bigBoard[smallIndex] = smallWinner;
        // é«˜äº®è·èƒœå°æ£‹ç›˜
        const smallBoardEl = bigBoardEl.children[smallIndex];
        smallBoardEl.classList.add('winner');
        // æ£€æŸ¥å¤§æ£‹ç›˜æ˜¯å¦åˆ†èƒœè´Ÿ
        const bigWinner = checkBigWinner();
        if (bigWinner) {
          game.isOver = true;
          game.playerScore++;
          playerScoreEl.textContent = game.playerScore;
          showNotification('æ­å–œï¼Œä½ èµ¢äº†ï¼', 'success');
          return;
        }
      }

      // æ›´æ–°ä¸‹ä¸€ä¸ªå¿…é¡»è½å­çš„å°æ£‹ç›˜
      const nextSmall = cellIndex;
      if (game.bigBoard[nextSmall] || isSmallBoardFull(nextSmall)) {
        game.activeSmall = -1;
        hintEl.textContent = 'æŒ‡å®šå°æ£‹ç›˜ä¸å¯ç”¨ï¼Œå¯ä»»æ„é€‰æ‹©å°æ£‹ç›˜è½å­';
      } else {
        game.activeSmall = nextSmall;
        hintEl.textContent = `ä¸‹ä¸€å›åˆéœ€åœ¨å°æ£‹ç›˜ ${nextSmall} è½å­`;
      }

      // åˆ‡æ¢åˆ°ç”µè„‘å›åˆ
      game.currentPlayer = 'O';
      updateTurnIndicator();
      // é‡æ–°æ¸²æŸ“æ£‹ç›˜ï¼Œæ›´æ–°æ´»è·ƒå°æ£‹ç›˜çŠ¶æ€
      renderBoard();
      // ç”µè„‘å»¶è¿Ÿè½å­ï¼ˆæ¨¡æ‹Ÿæ€è€ƒï¼‰
      setTimeout(computerMove, 800);
    }

    // ç”µè„‘è½å­é€»è¾‘ï¼ˆç®€å•éšæœºï¼Œå¯ä¼˜åŒ–ä¸ºæ™ºèƒ½ç®—æ³•ï¼‰
    function computerMove() {
      if (game.isOver || game.currentPlayer !== 'O') return;

      let availableMoves = [];

      // ä¼˜å…ˆæ£€æŸ¥ activeSmall
      if (game.activeSmall !== -1) {
        const smallIndex = game.activeSmall;
        if (!game.bigBoard[smallIndex] && !isSmallBoardFull(smallIndex)) {
          // æ£€æŸ¥æ˜¯å¦æœ‰èƒ½èµ¢çš„ä½ç½®
          const winningMove = findWinningMove(smallIndex, 'O');
          if (winningMove !== -1) {
            availableMoves.push({ small: smallIndex, cell: winningMove });
          } else {
            // æ£€æŸ¥æ˜¯å¦éœ€è¦é˜²å®ˆ
            const blockingMove = findWinningMove(smallIndex, 'X');
            if (blockingMove !== -1) {
              availableMoves.push({ small: smallIndex, cell: blockingMove });
            } else {
              // é€‰æ‹©æœ€ä¼˜ä½ç½®ï¼ˆä¸­å¿ƒä¼˜å…ˆï¼Œè§’è½å…¶æ¬¡ï¼Œè¾¹ç¼˜æœ€åï¼‰
              const preferredMoves = [4, 0, 2, 6, 8, 1, 3, 5, 7];
              for (const move of preferredMoves) {
                if (!game.smallBoards[smallIndex][move]) {
                  availableMoves.push({ small: smallIndex, cell: move });
                  break;
                }
              }
            }
          }
          
          // å¦‚æœæ²¡æœ‰æ‰¾åˆ°æœ€ä¼˜ä½ç½®ï¼Œæ·»åŠ æ‰€æœ‰å¯ç”¨ä½ç½®
          if (availableMoves.length === 0) {
            for (let cell = 0; cell < 9; cell++) {
              if (!game.smallBoards[smallIndex][cell]) {
                availableMoves.push({ small: smallIndex, cell });
              }
            }
          }
        }
      }

      // å¦‚æœ activeSmall ä¸å¯ç”¨ï¼Œéå†æ‰€æœ‰å°æ£‹ç›˜æ‰¾ä½ç½®
      if (availableMoves.length === 0) {
        for (let small = 0; small < 9; small++) {
          if (game.bigBoard[small] || isSmallBoardFull(small)) continue;
          
          // æ£€æŸ¥æ˜¯å¦æœ‰èƒ½èµ¢çš„å°æ£‹ç›˜
          const winningMove = findWinningMove(small, 'O');
          if (winningMove !== -1) {
            availableMoves.push({ small, cell: winningMove });
            break;
          }
          
          // æ£€æŸ¥æ˜¯å¦éœ€è¦é˜²å®ˆ
          const blockingMove = findWinningMove(small, 'X');
          if (blockingMove !== -1) {
            availableMoves.push({ small, cell: blockingMove });
            break;
          }
          
          // æ”¶é›†æ‰€æœ‰å¯ç”¨ä½ç½®
          for (let cell = 0; cell < 9; cell++) {
            if (!game.smallBoards[small][cell]) {
              availableMoves.push({ small, cell });
            }
          }
        }
      }

      // æ— å¯ç”¨ä½ç½®ï¼ˆç†è®ºä¸Šä¸ä¼šï¼Œå› ä¸ºæ¸¸æˆæ²¡ç»“æŸï¼‰
      if (availableMoves.length === 0) {
        showNotification('å¹³å±€ï¼', 'info');
        game.isOver = true;
        return;
      }

      // éšæœºé€‰ä¸€ä¸ªä½ç½®è½å­
      const randomMove = availableMoves[0]; // å·²ç»æŒ‰ä¼˜å…ˆçº§æ’åºï¼Œé€‰ç¬¬ä¸€ä¸ª
      const smallIndex = randomMove.small;
      const cellIndex = randomMove.cell;
      game.smallBoards[smallIndex][cellIndex] = 'O';
      const cellEl = Array.from(bigBoardEl.children[smallIndex].children)[cellIndex];
      cellEl.innerHTML = '<i class="fa fa-circle computer-icon"></i>'; // ä¿®æ”¹ä¸º Font Awesome 4.x å…¼å®¹çš„å›¾æ ‡ç±»å
      cellEl.classList.add('disabled');
      
      // æ·»åŠ è½å­åŠ¨ç”»
      const icon = cellEl.querySelector('.computer-icon');
      icon.style.transform = 'scale(0)';
      icon.style.opacity = '0';
      setTimeout(() => {
        icon.style.transition = 'all 0.3s ease';
        icon.style.transform = 'scale(1)';
        icon.style.opacity = '1';
      }, 10);

      // æ£€æŸ¥å½“å‰å°æ£‹ç›˜æ˜¯å¦åˆ†èƒœè´Ÿ
      const smallWinner = checkSmallWinner(smallIndex);
      if (smallWinner) {
        game.bigBoard[smallIndex] = smallWinner;
        const smallBoardEl = bigBoardEl.children[smallIndex];
        smallBoardEl.classList.add('winner');
        // æ£€æŸ¥å¤§æ£‹ç›˜æ˜¯å¦åˆ†èƒœè´Ÿ
        const bigWinner = checkBigWinner();
        if (bigWinner) {
          game.isOver = true;
          game.computerScore++;
          computerScoreEl.textContent = game.computerScore;
          showNotification('ç”µè„‘èµ¢äº†ï¼', 'error');
          return;
        }
      }

      // æ›´æ–°ä¸‹ä¸€ä¸ªå¿…é¡»è½å­çš„å°æ£‹ç›˜
      const nextSmall = cellIndex;
      if (game.bigBoard[nextSmall] || isSmallBoardFull(nextSmall)) {
        game.activeSmall = -1;
        hintEl.textContent = 'æŒ‡å®šå°æ£‹ç›˜ä¸å¯ç”¨ï¼Œå¯ä»»æ„é€‰æ‹©å°æ£‹ç›˜è½å­';
      } else {
        game.activeSmall = nextSmall;
        hintEl.textContent = `ä¸‹ä¸€å›åˆéœ€åœ¨å°æ£‹ç›˜ ${nextSmall} è½å­`;
      }

      // åˆ‡æ¢å›ç©å®¶å›åˆ
      game.currentPlayer = 'X';
      updateTurnIndicator();
      // é‡æ–°æ¸²æŸ“æ£‹ç›˜ï¼Œæ›´æ–°æ´»è·ƒå°æ£‹ç›˜çŠ¶æ€
      renderBoard();
    }

    // å¯»æ‰¾èƒ½èµ¢çš„ä½ç½®
    function findWinningMove(smallIndex, player) {
      const board = game.smallBoards[smallIndex];
      const winLines = [
        [0, 1, 2], [3, 4, 5], [6, 7, 8], // æ¨ª
        [0, 3, 6], [1, 4, 7], [2, 5, 8], // ç«–
        [0, 4, 8], [2, 4, 6] // æ–œ
      ];
      
      for (const line of winLines) {
        const [a, b, c] = line;
        if (board[a] === player && board[b] === player && !board[c]) {
          return c;
        }
        if (board[a] === player && board[c] === player && !board[b]) {
          return b;
        }
        if (board[b] === player && board[c] === player && !board[a]) {
          return a;
        }
      }
      return -1; // æ²¡æœ‰æ‰¾åˆ°èƒ½èµ¢çš„ä½ç½®
    }

    // æ£€æŸ¥å°æ£‹ç›˜æ˜¯å¦æœ‰èƒœè€…ï¼ˆä¸‰å­è¿çº¿ï¼‰
    function checkSmallWinner(smallIndex) {
      const board = game.smallBoards[smallIndex];
      // æ‰€æœ‰å¯èƒ½çš„è·èƒœç»„åˆ
      const winLines = [
        [0, 1, 2], [3, 4, 5], [6, 7, 8], // æ¨ª
        [0, 3, 6], [1, 4, 7], [2, 5, 8], // ç«–
        [0, 4, 8], [2, 4, 6] // æ–œ
      ];
      for (const line of winLines) {
        const [a, b, c] = line;
        if (board[a] && board[a] === board[b] && board[a] === board[c]) {
          return board[a];
        }
      }
      return null;
    }

    // æ£€æŸ¥å¤§æ£‹ç›˜æ˜¯å¦æœ‰èƒœè€…ï¼ˆå é¢†ä¸‰ä¸ªå°æ£‹ç›˜ï¼‰
    function checkBigWinner() {
      const board = game.bigBoard;
      const winLines = [
        [0, 1, 2], [3, 4, 5], [6, 7, 8], // æ¨ª
        [0, 3, 6], [1, 4, 7], [2, 5, 8], // ç«–
        [0, 4, 8], [2, 4, 6] // æ–œ
      ];
      for (const line of winLines) {
        const [a, b, c] = line;
        if (board[a] && board[a] === board[b] && board[a] === board[c]) {
          return board[a];
        }
      }
      // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å°æ£‹ç›˜éƒ½åˆ†èƒœè´Ÿï¼ˆå¹³å±€ï¼‰
      if (board.every(winner => winner !== null)) {
        showNotification('å¹³å±€ï¼', 'info');
        game.isOver = true;
      }
      return null;
    }

    // æ£€æŸ¥å°æ£‹ç›˜æ˜¯å¦å·²æ»¡
    function isSmallBoardFull(smallIndex) {
      return game.smallBoards[smallIndex].every(cell => cell !== null);
    }

    // é‡æ–°å¼€å§‹æ¸¸æˆ
    function restartGame() {
      game = {
        bigBoard: Array(9).fill(null),
        smallBoards: Array(9).fill(null).map(() => Array(9).fill(null)),
        currentPlayer: 'X',
        activeSmall: -1,
        playerScore: game.playerScore, // ä¿ç•™åˆ†æ•°
        computerScore: game.computerScore,
        isOver: false
      };
      renderBoard();
      hintEl.textContent = 'ç‚¹å‡»å°æ ¼å­è½å­ï¼Œä¸‹ä¸€å›åˆéœ€åœ¨å¯¹åº”å°æ£‹ç›˜ä½ç½®è½å­';
      updateTurnIndicator();
    }

    // æ›´æ–°å›åˆæŒ‡ç¤ºå™¨
    function updateTurnIndicator() {
      hintEl.style.color = game.currentPlayer === 'X' ? '#165DFF' : '#FF7D00';
    }

    // æ˜¾ç¤ºé€šçŸ¥
    function showNotification(message, type = 'info') {
      // åˆ›å»ºé€šçŸ¥å…ƒç´ 
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.textContent = message;
      
      // æ ¹æ®ç±»å‹è®¾ç½®æ ·å¼
      if (type === 'success') {
        notification.style.backgroundColor = '#22C55E';
      } else if (type === 'error') {
        notification.style.backgroundColor = '#EF4444';
      } else if (type === 'info') {
        notification.style.backgroundColor = '#3B82F6';
      }
      
      // æ·»åŠ åˆ°é¡µé¢
      document.body.appendChild(notification);
      
      // è®¾ç½®åŠ¨ç”»å’Œè‡ªåŠ¨æ¶ˆå¤±
      setTimeout(() => {
        notification.style.opacity = '1';
        notification.style.transform = 'translateY(0)';
      }, 10);
      
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateY(-20px)';
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }

    // æ·»åŠ é€šçŸ¥æ ·å¼
    const style = document.createElement('style');
    style.textContent = `
      .notification {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%) translateY(-20px);
        padding: 12px 20px;
        border-radius: 8px;
        color: white;
        font-size: 1rem;
        font-weight: 500;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 100;
        opacity: 0;
        transition: all 0.3s ease;
      }
    `;
    document.head.appendChild(style);

    // é¡µé¢åŠ è½½ååˆå§‹åŒ–
    window.onload = function() {
      init();
      updateTurnIndicator();
    };
  </script>
</body>
</html>
